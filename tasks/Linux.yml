---
- name: Installing filebeat on current OS
  include_tasks: '{{ platform_tasks }}'
  with_first_found:
    - '{{ ansible_os_family }}.yml'
    - not-supported.yml
  loop_control:
    loop_var: platform_tasks

- name: Configure settings block
  block:
    - name: Setup path folders
      file:
        path: '{{ path_folder.value }}'
        state: directory
      with_dict: '{{ path }}'
      loop_control:
        loop_var: path_folder

    - name: Copy Configuration File
      template:
        src: filebeat.yml.j2
        dest: '{{ path.config }}/filebeat.yml'
        owner: root
        group: root
        mode: 0644

    - name: templating init script
      template:
        src: '{{ filebeat.service.template }}.j2'
        dest: '{{ filebeat.service.path }}'
        owner: root
        group: root
        mode: u+rwx
      notify: '{{ filebeat.service.handler }}'
  become: True