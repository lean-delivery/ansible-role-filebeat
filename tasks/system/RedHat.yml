---

- name: Add Beats repository for {{ ansible_os_family }}
  become: True
  yum_repository:
    name: "filebeat-{{ elastic_branch }}.x"
    description: "Beats repository"
    baseurl: 'https://artifacts.elastic.co/packages/{{ elastic_branch }}.x/yum'
    gpgcheck: True
    gpgkey: '{{ elastic_gpg_key }}'
    enabled: True

- name: Install filebeat
  become: True
  package:
    name: filebeat
    state: present
  register: installed_package
  until: installed_package is succeeded

- name: Copy Configuration File
  become: True
  template:
    src: filebeat.yml.j2
    dest: /etc/filebeat/filebeat.yml
    owner: root
    group: root
    mode: 0644
  notify: Restart filebeat
